{"version":3,"sources":["../src/lib/copilot-cloud.ts"],"sourcesContent":["import {\n  COPILOT_CLOUD_API_URL,\n  COPILOT_CLOUD_VERSION,\n  COPILOT_CLOUD_PUBLIC_API_KEY_HEADER,\n  CopilotCloudConfig,\n  Message,\n} from \"@copilotkit/shared\";\n\nexport interface CloudCheckGuardrailsInputParams {\n  cloud: CopilotCloudConfig;\n  publicApiKey: string;\n  messages: Message[];\n}\n\nexport interface CloudCheckGuardrailsInputResponse {\n  status: \"allowed\" | \"denied\";\n  reason: string;\n}\n\nexport abstract class CopilotCloud {\n  abstract checkGuardrailsInput(\n    params: CloudCheckGuardrailsInputParams,\n  ): Promise<CloudCheckGuardrailsInputResponse>;\n}\n\nexport class RemoteCopilotCloud extends CopilotCloud {\n  constructor(private readonly cloudApiUrl: string = COPILOT_CLOUD_API_URL) {\n    super();\n  }\n\n  async checkGuardrailsInput({\n    cloud,\n    publicApiKey,\n    messages,\n  }: CloudCheckGuardrailsInputParams): Promise<CloudCheckGuardrailsInputResponse> {\n    const url = `${this.cloudApiUrl}/${COPILOT_CLOUD_VERSION}/copilotkit/guardrails/input`;\n\n    const response = await fetch(url, {\n      method: \"PUT\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        [COPILOT_CLOUD_PUBLIC_API_KEY_HEADER]: publicApiKey,\n      },\n      body: JSON.stringify({ messages, cloud }),\n    });\n\n    if (!response.ok) {\n      let message = response.statusText;\n\n      // try to parse the response body for a more detailed error message\n      try {\n        const json = await response.json();\n        if (json.message) {\n          message = json.message;\n        }\n      } catch (error) {}\n\n      throw new Error(\"Failed to check input guardrails: \" + message);\n    }\n    const json = await response.json();\n    return { status: json.status, reason: json.reason };\n  }\n}\n"],"mappings":";AAAA;AAAA,EACE;AAAA,EACA;AAAA,EACA;AAAA,OAGK;AAaA,IAAe,eAAf,MAA4B;AAInC;AAEO,IAAM,qBAAN,cAAiC,aAAa;AAAA,EACnD,YAA6B,cAAsB,uBAAuB;AACxE,UAAM;AADqB;AAAA,EAE7B;AAAA,EAEA,MAAM,qBAAqB;AAAA,IACzB;AAAA,IACA;AAAA,IACA;AAAA,EACF,GAAgF;AAC9E,UAAM,MAAM,GAAG,KAAK,eAAe;AAEnC,UAAM,WAAW,MAAM,MAAM,KAAK;AAAA,MAChC,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,CAAC,mCAAmC,GAAG;AAAA,MACzC;AAAA,MACA,MAAM,KAAK,UAAU,EAAE,UAAU,MAAM,CAAC;AAAA,IAC1C,CAAC;AAED,QAAI,CAAC,SAAS,IAAI;AAChB,UAAI,UAAU,SAAS;AAGvB,UAAI;AACF,cAAMA,QAAO,MAAM,SAAS,KAAK;AACjC,YAAIA,MAAK,SAAS;AAChB,oBAAUA,MAAK;AAAA,QACjB;AAAA,MACF,SAAS,OAAP;AAAA,MAAe;AAEjB,YAAM,IAAI,MAAM,uCAAuC,OAAO;AAAA,IAChE;AACA,UAAM,OAAO,MAAM,SAAS,KAAK;AACjC,WAAO,EAAE,QAAQ,KAAK,QAAQ,QAAQ,KAAK,OAAO;AAAA,EACpD;AACF;","names":["json"]}